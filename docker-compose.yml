version: "3.8"
services:
  user-service:
    build:
      context: ./user-service #Build from the users service
      dockerfile: ./Dockerfile
    volumes:
      - ./user-service:/app #Mount the user-service directory to /app in the container
      - /app/node_modules # Prevents overwriting node_modules
    # ports:
    #   - "8000:8000"
  product-catalog-service:
    depends_on:
      - user-service
    build:
      context: ./product-catalog-service
      dockerfile: Dockerfile
    volumes:
      - ./product-catalog-service:/app #Mount the product-catalog-service directory to /app in the container
      - /app/node_modules # Prevents overwriting node_modules
    # ports:
    #   - "5000:5000"
  shopping-cart-service:
    depends_on:
      - user-service
      - product-catalog-service
    build:
      context: ./shopping-cart-service
      dockerfile: Dockerfile
    volumes:
      - ./shopping-cart-service:/app
      - /app/node_modules
    # ports:
    #   - "8080:8080"
  order-service:
    build:
      context: ./order-service
      dockerfile: ./Dockerfile
    volumes:
      - ./order-service:/app #Mount the product-catalog-service directory to /app in the container
      - /app/node_modules # Prevents overwriting node_modules
    # ports:
    #   - "9000:9000"
  #payment-service:
  api-gateway-service:
    image: nginx:1.27.3-alpine
    container_name: api-gateway-service
    ports:
      - "80:80"
    volumes:
      - ./api-gateway-service/nginx.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - user-service
      - product-catalog-service
      - shopping-cart-service
      - order-service
